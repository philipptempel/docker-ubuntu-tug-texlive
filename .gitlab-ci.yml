stages:
  - infraonly
  - minimal
  - basic
  - small
  - medium
  - full


.docker-build:
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" "$CI_REGISTRY"
    - docker login -u "$DOCKER_REGISTRY_USER" -p "$DOCKER_REGISTRY_PASSWORD" "$DOCKER_REGISTRY"


infraonly-scheme:
  extends: .docker-build
  stage: infraonly
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "infraonly"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "infraonly"


minimal-scheme:
  extends: .docker-build
  stage: minimal
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "minimal"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "minimal"


basic-scheme:
  extends: .docker-build
  stage: basic
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "basic"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "basic"


small-scheme:
  extends: .docker-build
  stage: small
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "small"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "small"


medium-scheme:
  extends: .docker-build
  stage: medium
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "medium"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "medium"


full-scheme:
  extends: .docker-build
  stage: full
  script:
    - ./src/maker.sh build "$TEXLIVE_YEAR" "full"
    - ./src/maker.sh push "$TEXLIVE_YEAR" "full"
